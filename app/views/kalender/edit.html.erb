<% content_for :js do %>

	var timep = new RegExp("\\b[012][0-9]:[0-5][0-9]\\b");
	var datep = new RegExp("\\b[0123][0-9]\\.[01][0-9]\\.[0-9]{4}\\b");
 
	function checkdate(){
		if( timep.test($("#time_begin").val()) && datep.test($("#date_begin").val()) &&
			timep.test($("#time_end").val()) && datep.test($("#date_end").val()) ){
			return true;
		}
		else{
			$( '#error' ).empty();
			$( '#error' ).html( "Falsches Datumsformat: erwartet <i>hh:mm</i> <br> TT:MM:JJJJ z.B. 10:35 01.09.2011" );
			return false;
		}
	};

<% end %>


<% content_for :ready do %>
	
	$('.time-pick').timepicker({
		'timeFormat': 'H:i',
		'minTime': '00:00',
		'maxTime': '23:45',
		'step': 15,		
		'showDuration': false
	});
	
	$(function() {
		$( ".date-pick" ).datepicker( $.datepicker.regional['de'] ); 
	});


	
<% end %>


<h1>Termin</h1>

<%= form_for @termin, :url => { :action => :update, :id => @termin.id, :kjahr => @kaldatum.year, :kmonat => @kaldatum.month, :ktag => @kaldatum.day } do |termin| %>
	<table>
		<tr>
			<td>
				<label>Autor:</label>
			</td>
			<td>
			  <%= termin.select :autor, options_for_select( KalenderController::AUTOREN, @termin.autor  ) %>
			</td>
		</tr>
		<tr>
			<td>
				<label>Thema:</label>
			</td>
			<td>
				<%= termin.text_field :thema, :value => @termin.thema, :size => 50 %>
			</td>
		</tr>
		<tr>
			<td>
				<label>Zeit:</label>
			</td>
			<td>
				<table class="blank">
					<tr>
						<td class="blank">
							<label>Beginn</label>
						</td>
						<td class="blank">
							<%= termin.text_field :time_begin, :id => "time_begin", :class=> "time-pick", :value => @termin.beginn.strftime("%H:%M"), :size => 5 %>
							<%= termin.text_field :date_begin, :id => "date_begin", :class=> "date-pick", :value => @termin.beginn.strftime("%d.%m.%Y"), :size => 10 %>
							<!-- %= time_select :termin, :beginn, :default => @termin.beginn, :minute_step => 15 % -->
							<!-- label --> <!-- am  --> <!-- /label -->
							<!-- %= date_select :termin, :beginn, :default => @termin.beginn, :order => [:day, :month, :year] % -->
						</td>
					</tr>
					<tr>
						<td class="blank">
							<label>Ende</label>
						</td>
						<td class="blank">
							<%= termin.text_field :time_end, :id => "time_end", :class=> "time-pick", :value => @termin.ende.strftime("%H:%M"), :size => 5 %>
							<%= termin.text_field :date_end, :id => "date_end", :class=> "date-pick", :value => @termin.ende.strftime("%d.%m.%Y"), :size => 10 %>
							
							<!-- %= time_select :termin, :ende, :default => @termin.ende, :minute_step => 15 % -->
							<!-- label --> <!-- am  --> <!-- /label -->
							<!-- %= date_select :termin, :ende, :default => @termin.ende, :order => [:day, :month, :year] % -->
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	<p> <!-- %= submit_tag("sichern") % --> <%= submit_tag( "sichern", :id => "sichern", :onclick => 'return checkdate();' ) %>  

		<%= link_to 'abbrechen', :action => 'index', :Jahr => @kaldatum.year, :Monat => @kaldatum.month, :Tag => @kaldatum.day %>   

		<%= link_to 'löschen', kalender_path(@termin, :kjahr => @kaldatum.year, :kmonat => @kaldatum.month, :ktag => @kaldatum.day ), :method => 'delete', :confirm => "Termin: " + @termin.thema + @termin.beginn.strftime(" %H:%M-") + @termin.ende.strftime("%H:%M ") + "löschen?" %>
	</p>

<% end %>

